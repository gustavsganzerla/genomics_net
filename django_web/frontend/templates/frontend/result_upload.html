{% extends 'frontend/base.html' %}

{% block title %}Uploaded Genome{% endblock %}

{% block content %}

<h2>Uploaded genome</h2>
<table>
    <tbody>
        <tr>
            <td>Fasta header</td>
            <td>{{header}}</td>
        </tr>
        <tr>
            <td>Genome length</td>
            <td>{{length}}</td>
        </tr>
        <tr>
            <td>Proportion of A</td>
            <td>{{a_proportion}}</td>
        </tr>
        <tr>
            <td>Proportion of T</td>
            <td>{{t_proportion}}</td>
        </tr>
        <tr>
            <td>Proportion of C</td>
            <td>{{c_proportion}}</td>
        </tr>
        <tr>
            <td>Proportion of G</td>
            <td>{{g_proportion}}</td>
        </tr>
        <tr>
            <td>Proportion of N</td>
            <td>{{n_proportion}}</td>
        </tr>

    </tbody>
</table>


<!-- select reference once -->
<label for="reference">Select reference genome:</label>
<select name="reference" id="reference" class="form-select">
    <option value="NC_003310">NC_003310 (Clade I)</option>
    <option value="NC_063383">NC_063383 (Clade II)</option>
</select>

<!-- Run Annotation -->
<form method="get" action="{% url 'annotate_genome' filename=filename %}" target="_blank" onsubmit="return appendReferenceAndNotify(this)">
    <button type="submit" class="btn btn-primary mt-3">Run Annotation</button>
  </form>
  
  <!-- Run Mutational Analysis -->
  <form method="get" action="{% url 'mutation_analysis' filename=filename %}" target="_blank" onsubmit="return appendReferenceAndNotify(this)">
    <button type="submit" class="btn btn-primary mt-3">Run Mutational Analysis</button>
  </form>
  
  <!-- Notification -->
  <div id="jobNotification" class="alert alert-info alert-dismissible fade d-none mt-3" role="alert">
    Job has started â€” results will open in a new tab.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

<p><p><p>
<a href="{% url 'home' %}">Back to Home</a>




<script>
    function appendReferenceAndNotify(form) {
      const reference = document.getElementById('reference').value;
      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'reference';
      input.value = reference;
      form.appendChild(input);
  
      // Show notification
      const notification = document.getElementById('jobNotification');
      notification.classList.remove('d-none');
      notification.classList.add('show');
  
      return true;
    }
  </script>
{% endblock %}
